<%= render BlacklightModalComponent.new do |component| %>
  <% component.with(:header, params[:dsid]) %>
  <% component.with(:body) do %>
    <% if params[:edit] %>
      <% if can?(:manage_item, @obj) %>
        <%= form_tag url_for(controller: :items, action: :datastream_update), id: 'xmlEditForm', method: :POST do %>
            <input type="hidden" name="id" value="<%= @obj.pid %>">
            <input name="dsid" id="datastream" type="hidden" value="<%= params[:dsid] %>">
            <div class="form-group">
              <textarea name="content" id="content" class='form-control'><%= @ds.content.to_s %></textarea>
            </div>
            <div class="form-group">
              <button type="submit" id="update" class="btn btn-primary">Update Datastream</button>
            </div>
        <% end %>
      <% end %>
    <% else %>
      <% # If the user is a repo admin or is permitted to manage both content and %>
      <% # rights, display raw xml editing %>
      <% if can?(:manage_item, @obj) && Settings.editable_datastreams.include?(params[:dsid]) %>
        <%= link_to "Edit #{@ds.dsid}", ds_solr_document_path(params[:id], @ds.dsid, edit: 'true'), title: @ds.dsid, data: { blacklight_modal: 'preserve' } %>
      <% end %>

      <% unless params[:dsid] == 'full_dc' %>
        <div class="CodeRay">
          <pre>
            <foxml:datastream ID="<%= @ds.dsid %>" STATE="<%= @ds.state %>" CONTROL_GROUP="<%= @ds.controlGroup %>" VERSIONABLE="<%= @ds.versionable %>">
            <foxml:datastreamVersion ID="<%= @ds.dsVersionID %>" LABEL="<%= @ds.label %>" CREATED="<%= @ds.createDate&.xmlschema %>" MIMETYPE="<%= @ds.mimeType %>">
          </pre>
        </div>
      <% end %>
      <%= CodeRay::Duo[:xml, :div].highlight(@content).html_safe %>
    <% end %>
  <% end %>
<% end %>
